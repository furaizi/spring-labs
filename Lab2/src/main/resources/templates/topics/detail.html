<!DOCTYPE html>
<html lang="ru" xmlns:http="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title th:text="${topic.title}">Topic</title>
</head>
<body>

<p><a th:href="@{/topics}">‚Üê Back to list</a></p>

<h1 th:text="${topic.title}">Topic title</h1>
<p th:text="${topic.description}">Topic description</p>

<ul>
    <li><b>Author:</b> <span th:text="${topic.author}">author</span></li>
    <li><b>Views:</b> <span th:text="${topic.viewCount}">0</span></li>
    <li><b>Replies:</b> <span th:text="${topic.replyCount}">0</span></li>
    <li><b>Pinned:</b> <span th:text="${topic.pinned}">false</span></li>
    <li><b>Closed:</b> <span th:text="${topic.closed}">false</span></li>
    <li><b>Tags:</b>
        <span th:text="${topic.tags != null && !topic.tags.isEmpty() ? #strings.listJoin(topic.tags, ', ') : '-'}">-</span>
    </li>
    <li><b>Created:</b>
        <span th:text="${topic.createdAt != null ? #temporals.format(topic.createdAt,'yyyy-MM-dd HH:mm') : '-'}">-</span>
    </li>
    <li><b>Last post:</b>
        <span th:text="${topic.lastPostAt != null ? #temporals.format(topic.lastPostAt,'yyyy-MM-dd HH:mm') : '-'}">-</span>
    </li>
</ul>

<p>
    <a th:href="@{/admin/topics/{id}/edit(id=${topic.id})}">Edit topic</a>
</p>

<hr/>
<h2>Posts</h2>

<ul>
    <li th:each="p : ${topic.posts}">
        <div>
            <b th:text="${p.title}">Post title</b>
            <small>
                (authorId: <span th:text="${p.authorId}">-</span>,
                created: <span th:text="${#temporals.format(p.createdAt,'yyyy-MM-dd HH:mm')}">-</span>)
            </small>
        </div>
        <div th:text="${p.content}">content...</div>
        <div>
            <a th:href="@{/posts/{id}(id=${p.id}, backToTopicId=${topic.id})}">Open</a>
            |
            <a th:href="@{/posts/{id}/edit(id=${p.id}, backToTopicId=${topic.id})}">Edit</a>
        </div>
        <hr/>
    </li>
    <li th:if="${topic.posts == null || #lists.isEmpty(topic.posts)}">No posts yet</li>
</ul>

<h3>Add post to this topic</h3>
<form th:action="@{/topics/{id}/posts(id=${topic.id})}" method="post">
    <p>
        <label>Title:
            <input type="text" name="title" required/>
        </label>
    </p>
    <p>
        <label>Author ID (UUID, optional):
            <input type="text" name="authorId" placeholder="leave empty to auto-generate"/>
        </label>
    </p>
    <p>
        <label>Content:<br/>
            <textarea name="content" rows="4" cols="60" required></textarea>
        </label>
    </p>
    <button type="submit">Create post</button>
</form>

<p>
    <a th:href="@{/posts/new(topicId=${topic.id})}">Open full post form</a>
</p>

</body>
</html>
